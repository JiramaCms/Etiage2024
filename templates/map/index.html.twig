{# templates/map.html.twig #}
{% extends 'base.html.twig' %}

{% block body %}
    <div class="container">
        <h1>My Leaflet Map</h1>
        <div id="mapid" style="height: 600px;"></div>
    </div>

    <script>
        // Initialiser la carte
        var mymap = L.map('mapid').setView([-18.917923, 47.522342], 13);

        // Ajouter une couche de tuiles (tiles layer)
        L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
            attribution: '&copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors'
        }).addTo(mymap);


        //code pour envoyer les coordonnées
        mymap.on('click', function(e) {
            var lat = e.latlng.lat;
            var lng = e.latlng.lng;
            var name = prompt("Enter the name for this location:");
            if (name !== null && name !== "") {
                // Appeler la fonction pour envoyer les coordonnées et le nom
                sendCoordinates(lat, lng, name);
            }
        });

         // Fonction pour envoyer les coordonnées au serveur
        function sendCoordinates(lat, lng,name) {
            // Créer un formulaire et l'envoyer
            var form = document.createElement('form');
            form.method = 'POST';
            form.action = '{{ path('point_save') }}';

            var latitudeInput = document.createElement('input');
            latitudeInput.type = 'hidden';
            latitudeInput.name = 'latitude';
            latitudeInput.value = lat;
            form.appendChild(latitudeInput);

            var longitudeInput = document.createElement('input');
            longitudeInput.type = 'hidden';
            longitudeInput.name = 'longitude';
            longitudeInput.value = lng;
            form.appendChild(longitudeInput);

            var nameInput = document.createElement('input');
            nameInput.type = 'hidden';
            nameInput.name = 'nom';
            nameInput.value = name;
            form.appendChild(nameInput);

            document.body.appendChild(form);
            form.submit();
        }














        // Ajouter un marqueur (marker)
        {% for point in allPoints %}
        L.marker([{{ point.latitude}}, {{point.longitude}}]).addTo(mymap)
            .bindPopup('Se trouve à {{point.nom}}')
            .closePopup();
        {% endfor %}

        L.circle([-18.919095, 47.525500], {
            color: 'red',
            fillColor: '#f03',
            fillOpacity: 0.5,
            radius: 200
        }).addTo(mymap)
            .bindPopup('cette zone est demilitarisé')
            .closePopup()

        var popup = L.popup();
        function onMapClick(e) {
            popup
                .setLatLng(e.latlng)
                .setContent("You clicked the map at " + e.latlng.toString())
                .openOn(mymap);
        }

        mymap.on('click', onMapClick);
    </script>
{% endblock %}